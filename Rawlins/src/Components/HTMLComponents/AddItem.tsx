import React, { useEffect, useState } from "react";

// interface Product {
//   prod_id: number
//   imageUrl: string;
//   name: string;
//   brand: string;
//   rating: number;
//   price: number;
// }

// const products: any= [
//   {
//     prod_id: 1,
//     name: "Product 1",
//     rating: 4,
//     brand: "Brand A",
//     price: 100,
//     imageUrl: "https://zzte-095.dx.commercecloud.salesforce.com/on/demandware.static/-/Sites-Rent_a_Center/default/dwe4ebd995/100029114-03.jpg"
//   },
//   {
//     prod_id: 2,
//     name: "Product 2",
//     rating: 4.5,
//     brand: "Brand B",
//     price: 120,
//     imageUrl: "https://zzte-095.dx.commercecloud.salesforce.com/on/demandware.static/-/Sites-Rent_a_Center/default/dwe4ebd995/100029114-03.jpg"
//   }
// ];

export default function AddItem(products: any) {
  const [currIndex, setCurrIndex] = useState<number>(0);
  const [currIndexOfRelated, setCurrIndexOfRelated] = useState<number>(0);
  const [showCart, setShowCart] = useState<boolean>(false);
  const [cartItems, setCartItems] = useState<any>([]);
  const [relatedItems, setRelatedItems] = useState<any>([]);
  const [addButton, setAddButton] = useState(true);
  const static_products = products.record.value;

  const handleNext = () => {
    setCurrIndex((currIndex: any) => (currIndex + 1) % static_products.length);
  };

  const handlePrev = () => {

    setCurrIndex(
      (currIndex: any) =>
        (currIndex - 1 + static_products.length) % static_products.length
    );
  };

  const handleNextRelated = () => {
    setCurrIndexOfRelated(
      (currIndexOfRelated: any) =>
        (currIndexOfRelated + 1) % relatedItems.length
    );
    // console.log(currIndex, "currr after next",(currIndex + 1) % static_products.length);
  };

  const handlePrevRelated = () => {
    setCurrIndexOfRelated(
      (currIndexOfRelated: any) =>
        (currIndexOfRelated - 1 + relatedItems.length) % relatedItems.length
    );
  };

  useEffect(() => {
    setCartItems(products);
  }, [products?.record?.value]);

  useEffect(() => {
    console.log("cart items\n\n", cartItems);
  }, [cartItems]);

  const handleRelatedItems = (currIndex: any) => {
    var currentProducts = cartItems?.record?.value;
    const productFound = currentProducts.find(
      (product: any, index: number) => index === currIndex
    );
    // console.log("Related Items clicked for product:", products.record.value[currIndex].prod_id);
    const prod_id: number = productFound?.id;

    if (prod_id) {
      products?.record?.agent(prod_id);
    }
  };

  const productReview = (currIndex: any) => {
    var currentProducts = cartItems?.record?.value;
    const productFound = currentProducts.find(
      (product: any, index: number) => index === currIndex
    );
    // console.log("Related Items clicked for product:", products.record.value[currIndex].prod_id);
    const prod_id: number = productFound?.id;
    const reviewData = "Show me the review of the product"
    if (prod_id) {
      products?.record?.agent(prod_id, reviewData);
    }
  }

  const addToCart = () => {
    const prod_id: number = relatedItems[currIndex]?.prod_id;
    //API call
  };

  const show_items = (currentIndex: number) => {
    const currentItem = cartItems?.record?.value[currentIndex];

    return (
      <>
        <tr>
          <td className="title">Name</td>
          <td className="content">
            {currentItem?.productName ? currentItem?.productName : "-"}
          </td>
        </tr>
        <tr>
          <td className="title">Brand</td>
          <td className="content">
            {currentItem?.brand ? currentItem?.brand : "-"}
          </td>
        </tr>
        <tr>
          <td className="title">Rating</td>
          <td className="content">
            {currentItem?.rating ? currentItem?.rating : "-"}
          </td>
        </tr>
        <tr>
          <td className="title">Price</td>
          <td className="content">
            {currentItem?.price ? currentItem?.price : "-"}
          </td>
        </tr>
      </>
    );
  };

  const show_related_items = (currentIndex = 0) => {
    const currentItem = relatedItems[currentIndex];

    //  cartItems?.record?.value?.map((value:any, index:any) => (
    return (
      <>
        <tr>
          <td className="title">Name</td>
          <td className="content">{currentItem?.productName}</td>
        </tr>
        <tr>
          <td className="title">Brand</td>
          <td className="content">{currentItem?.brand}</td>
        </tr>
        <tr>
          <td className="title">Rating</td>
          <td className="content">{currentItem?.rating}</td>
        </tr>
        <tr>
          <td className="title">Price</td>
          <td className="content">{currentItem?.Price}</td>
        </tr>
      </>
    );
  };

  return (
    <div className="ai-bot-content">
      <div className="product-slider">
        <a href="#" className="product-slider-next" onClick={handleNext}></a>
        <a href="#" className="product-slider-prev" onClick={handlePrev}></a>
        <div className="slider-item-container">
          <div className="slider-item">
            <div className="prod-img-container">
              <img
                src={cartItems?.record?.value[currIndex]?.images}
                alt={cartItems?.record?.value[currIndex]?.name}
              />
            </div>
            <table className="prod-details">
              <tbody>{show_items(currIndex)}</tbody>
            </table>
          </div>
        </div>
      </div>

      <button
        className="btn-add-to-cart"
        onClick={() => {
          handleRelatedItems(currIndex);
        }}
      >
        {cartItems?.record?.value[currIndex]?.bt}
      </button>
      <button
        className="btn-add-to-cart"
        onClick={() => {
          productReview(currIndex);
        }}
      >
        Get Review
      </button>

    </div>
  );
}
